import React, {useState, useEffect } from 'react'
import Head from 'next/head'
import { useRouter } from 'next/router'
import axios from 'axios'
import { toast } from 'react-toastify'
import {HStack, VStack} from '@chakra-ui/react'
import { Button, Checkbox, Form, Input, Typography, Alert  } from 'antd';
import styles from './index.module.css'
import { ToastContainer } from 'react-toastify'
import ClientCaptcha from "react-client-captcha"
import "react-client-captcha/dist/index.css"
import 'react-toastify/dist/ReactToastify.css'

const { Paragraph , Title } = Typography;
const Login = () => {
  const [userName, setUserName] = useState()
  const [email, setEmail] = useState()
  const [password, setPassword] = useState()
  const [statusCode, setStatusCode] = useState()
  const [error,setError] = useState(false)
  const [remember,setRemember] = useState(false)
  const [errorText,setErrorText] = useState('')
  const [captcha, setCaptcha] =useState('')
  const router = useRouter()

  function createCaptcha(captchaCode){
    setCaptcha(captchaCode)
  }
  async function submitLogin(data){
    if(data.capchaText === captcha){
      return await axios
      .post('http://localhost:3001/user/login', {email: data.email, password: data.password})
      .then((res) => {
        setEmail(data.email)
        setPassword(data.password)
        setUserName(res.data.userName)
        setStatusCode(res.status)
        if(data.remember){
          window.localStorage.setItem('fullNameTracuu', res.data.userName)
          window.localStorage.setItem('emailTracuu', data.email)
          window.localStorage.setItem('passwordTracuu', data.password)
          window.localStorage.setItem('rememberTracuu', JSON.stringify(data.remember))
        }
        
        router.push('/thunhapthang')
        return(result)
      })
      .catch(function (error) {
        // handle error
        toast.error(error?.response?.data.message)
      })
    }else{
      toast.error('Vui lòng nhập lại mã Captcha.')
    }
    
  }
  useEffect(() => {
  }, [])

  return (
    <div className={styles.container}>
      <Head>
        <title>Tra cứu thu nhập | Login </title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon-16x16.png" />
      </Head>
      <main className={styles.main}>
        <section className={styles.loginSection}>
        {/* <Avatar size={{sx: 64, sm: 64, md: 64, lg: 80, xl:80, xxl: 80}} src ={'./logo.jpg'} />
        */}
        <div style={{background: '#163764', marginBottom: '1rem', borderRadius: '5px'}}>
        <a
            href="https://ufm.edu.vn/"
            target="_blank"
            rel="noopener noreferrer"
          >
          <img src='./logo4.png'/>
          </a>
        </div>
        <Title level={2}>ĐĂNG NHẬP</Title>
        <Paragraph><b>HỆ THỐNG TRA CỨU THÔNG TIN THU NHẬP</b></Paragraph >
        <VStack margin={"2em"} alignItems={"center"}>
          <Form
              name="basic"
              labelCol={{
                span: 8,
              }}
              wrapperCol={{
                span: 20,
              }}
              initialValues={{
                remember: true,
              }}
              autoComplete="off"
              onFinish={submitLogin}
            >
              <Form.Item
                label="Email: "
                name="email"
                rules={[
                  {
                    required: true,
                    message: 'Vui lòng nhập Email!',
                    type:'email'
                  },
                ]}
              >
                <Input />
              </Form.Item>

              <Form.Item
                label="Mật khẩu: "
                name="password"
                rules={[
                  {
                    required: true,
                    message: 'Vui lòng nhập mật khẩu!',
                  },
                ]}
              >
                <Input.Password />
              </Form.Item>
              <HStack alignItems={'start'}>
              <Form.Item
                name="capchaText"
                rules={[
                  {
                    required: true,
                    message: 'Vui lòng nhập mã Capcha!',
                  },
                ]}
              >
                <Input placeholder='Nhập mã Capcha' />
              </Form.Item>
              <ClientCaptcha captchaCode ={createCaptcha} />
              </HStack>
              <Form.Item
                name="remember"
                valuePropName="checked"
                wrapperCol={{
                  offset: 8,
                  span: 16,
                }}
              >
                <Checkbox>Nhớ mật khẩu</Checkbox>
              </Form.Item>

              <VStack>
                <Button type="primary" block htmlType="submit">
                  Đăng nhập
                </Button>
              </VStack>
            </Form>
          </VStack>
        </section>
      </main>
      <footer className={styles.footer}>
        <a
          href="https://phongcntt.ufm.edu.vn/"
          target="_blank"
          rel="noopener noreferrer"
        >
          Coppyright by:{' '} © 2022 Phòng Công nghệ thông tin
        </a>
      </footer>
      <ToastContainer />
    </div>
   );
}

export default Login;
Login.getLayout = function PageLayout(page) {
  return <>{page}</>
}